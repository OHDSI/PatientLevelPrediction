<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Adding Custom Data Splitting • PatientLevelPrediction</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Adding Custom Data Splitting">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">PatientLevelPrediction</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">6.4.1.9999</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../articles/InstallationGuide.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/AddingCustomFeatureEngineering.html">Adding Custom Feature Engineering Functions</a></li>
    <li><a class="dropdown-item" href="../articles/AddingCustomModels.html">Adding Custom Patient-Level Prediction Algorithms</a></li>
    <li><a class="dropdown-item" href="../articles/AddingCustomSamples.html">Adding Custom Sampling Functions</a></li>
    <li><a class="dropdown-item" href="../articles/AddingCustomSplitting.html">Adding Custom Data Splitting</a></li>
    <li><a class="dropdown-item" href="../articles/BenchmarkTasks.html">Benchmark Tasks</a></li>
    <li><a class="dropdown-item" href="../articles/BestPractices.html">Best Practice Research</a></li>
    <li><a class="dropdown-item" href="../articles/BuildingMultiplePredictiveModels.html">Automatically Build Multiple Patient-Level Predictive Models</a></li>
    <li><a class="dropdown-item" href="../articles/BuildingPredictiveModels.html">Building patient-level predictive models</a></li>
    <li><a class="dropdown-item" href="../articles/ClinicalModels.html">Clinical Models</a></li>
    <li><a class="dropdown-item" href="../articles/ConstrainedPredictors.html">Constrained Predictors</a></li>
    <li><a class="dropdown-item" href="../articles/CreatingLearningCurves.html">Creating Learning Curves</a></li>
    <li><a class="dropdown-item" href="../articles/CreatingNetworkStudies.html">Making patient-level predictive network study packages</a></li>
    <li><a class="dropdown-item" href="../articles/GISExample.html">Integration of GIS Data Into OHDSI Model Building</a></li>
    <li><a class="dropdown-item" href="../articles/InstallationGuide.html">Patient-Level Prediction Installation Guide</a></li>
    <li><a class="dropdown-item" href="../articles/Videos.html">Demo Videos</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../articles/BenchmarkTasks.html">Benchmarks</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/ConstrainedPredictors.html">Predictors</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/BestPractices.html">Best Practices</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/ClinicalModels.html">Clinical Models</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://ohdsi.github.io/Hades"><img src='https://ohdsi.github.io/Hades/images/hadesMini.png' width=80 height=17 style='vertical-align: top;'></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/OHDSI/PatientLevelPrediction"><span class="fa fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Adding Custom Data Splitting</h1>
                        <h4 data-toc-skip class="author">Jenna Reps</h4>
            
            <h4 data-toc-skip class="date">2025-05-21</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/OHDSI/PatientLevelPrediction/blob/develop/vignettes/AddingCustomSplitting.Rmd" class="external-link"><code>vignettes/AddingCustomSplitting.Rmd</code></a></small>
      <div class="d-none name"><code>AddingCustomSplitting.Rmd</code></div>
    </div>

    
    
<!--
%\VignetteEngine{knitr::rmarkdown}
%\VignetteIndexEntry{Adding Custom Data Splitting}
%\VignetteEncoding{UTF-8}
-->
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette describes how you can add your own custom function for
splitting the labelled data into training data and validation data in
the Observational Health Data Sciencs and Informatics (OHDSI) <a href="https://github.com/OHDSI/PatientLevelPrediction" class="external-link"><code>PatientLevelPrediction</code></a>
package. This vignette assumes you have read and are comfortable with
building single patient level prediction models as described in the
<code>vignette('BuildingPredictiveModels)</code>. <strong>We invite you
to share your new data splitting functions with the OHDSI community
through our <a href="https://github.com/OHDSI/PatientLevelPrediction" class="external-link">GitHub
repository</a>.</strong></p>
</div>
<div class="section level2">
<h2 id="data-splitting-function-code-structure">Data Splitting Function Code Structure<a class="anchor" aria-label="anchor" href="#data-splitting-function-code-structure"></a>
</h2>
<p>To make a custom data splitting function that can be used within
PatientLevelPrediction you need to write two different functions. The
‘create’ function and the ‘implement’ function.</p>
<p>The ‘create’ function, e.g., create&lt;DataSplittingFunction&gt;,
takes the parameters of the data splitting ‘implement’ function as
input, checks these are valid and outputs these as a list of class
‘splitSettings’ with the ‘fun’ attribute specifying the ‘implement’
function to call.</p>
<p>The ‘implement’ function, e.g.,
implement&lt;DataSplittingFunction&gt;, must take as input: *
population: a data frame that contain rowId (patient identifier),
ageYear, gender and outcomeCount (the class labels) * splitSettings -
the output of your create&lt;DataSplittingFunction&gt;</p>
<p>The ‘implement’ function then needs to implement code to assign each
rowId in the population to a splitId (&lt;0 means in the train data, 0
means not used and &gt;0 means in the training data with the value
defining the cross validation fold).</p>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>Let’s consider the situation where we wish to create a split where
females are used to train a model but males are used to evaluate the
model.</p>
<div class="section level3">
<h3 id="create-function">Create function<a class="anchor" aria-label="anchor" href="#create-function"></a>
</h3>
<p>Our gender split function requires a single parameter, the number of
folds used in cross validation. Therefore create a function with a
single nfold input that returns a list of class ‘splitSettings’ with the
‘fun’ attribute specifying the ‘implement’ function we will use.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">createGenderSplit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">nfold</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># create list of inputs to implement function</span></span>
<span>  <span class="va">splitSettings</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nfold <span class="op">=</span> <span class="va">nfold</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># specify the function that will implement the sampling</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">splitSettings</span>, <span class="st">"fun"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"implementGenderSplit"</span></span>
<span></span>
<span>  <span class="co"># make sure the object returned is of class "sampleSettings"</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">splitSettings</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"splitSettings"</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">splitSettings</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We now need to create the ‘implement’ function
<code>implementGenderSplit()</code></p>
</div>
<div class="section level3">
<h3 id="implement-function">Implement function<a class="anchor" aria-label="anchor" href="#implement-function"></a>
</h3>
<p>All ‘implement’ functions for data splitting must take as input the
population and the splitSettings (this is the output of the ‘create’
function). They must return a data.frame containing columns: rowId and
index.</p>
<p>The index is used to determine whether the patient (identifed by the
rowId) is in the test set (index = -1) or train set (index &gt; 0). In
in the train set, the value corresponds to the cross validation fold.
For example, if rowId 2 is assigned index 5, then it means the patient
with the rowId 2 is used to train the model and is in fold 5.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">implementGenderSplit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">population</span>, <span class="va">splitSettings</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># find the people who are male:</span></span>
<span>  <span class="va">males</span> <span class="op">&lt;-</span> <span class="va">population</span><span class="op">$</span><span class="va">rowId</span><span class="op">[</span><span class="va">population</span><span class="op">$</span><span class="va">gender</span> <span class="op">==</span> <span class="fl">8507</span><span class="op">]</span></span>
<span>  <span class="va">females</span> <span class="op">&lt;-</span> <span class="va">population</span><span class="op">$</span><span class="va">rowId</span><span class="op">[</span><span class="va">population</span><span class="op">$</span><span class="va">gender</span> <span class="op">==</span> <span class="fl">8532</span><span class="op">]</span></span>
<span></span>
<span>  <span class="va">splitIds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    rowId <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">males</span>, <span class="va">females</span><span class="op">)</span>,</span>
<span>    index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">males</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">splitSettings</span><span class="op">$</span><span class="va">nfold</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">females</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># return the updated trainData</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">splitIds</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="acknowledgments">Acknowledgments<a class="anchor" aria-label="anchor" href="#acknowledgments"></a>
</h2>
<p>Considerable work has been dedicated to provide the
<code>PatientLevelPrediction</code> package.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/citation.html" class="external-link">citation</a></span><span class="op">(</span><span class="st">"PatientLevelPrediction"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## To cite PatientLevelPrediction in publications use:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Reps JM, Schuemie MJ, Suchard MA, Ryan PB, Rijnbeek P (2018). "Design</span></span>
<span><span class="co">##   and implementation of a standardized framework to generate and</span></span>
<span><span class="co">##   evaluate patient-level prediction models using observational</span></span>
<span><span class="co">##   healthcare data." _Journal of the American Medical Informatics</span></span>
<span><span class="co">##   Association_, *25*(8), 969-975.</span></span>
<span><span class="co">##   &lt;https://doi.org/10.1093/jamia/ocy032&gt;.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## A BibTeX entry for LaTeX users is</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   @Article{,</span></span>
<span><span class="co">##     author = {J. M. Reps and M. J. Schuemie and M. A. Suchard and P. B. Ryan and P. Rijnbeek},</span></span>
<span><span class="co">##     title = {Design and implementation of a standardized framework to generate and evaluate patient-level prediction models using observational healthcare data},</span></span>
<span><span class="co">##     journal = {Journal of the American Medical Informatics Association},</span></span>
<span><span class="co">##     volume = {25},</span></span>
<span><span class="co">##     number = {8},</span></span>
<span><span class="co">##     pages = {969-975},</span></span>
<span><span class="co">##     year = {2018},</span></span>
<span><span class="co">##     url = {https://doi.org/10.1093/jamia/ocy032},</span></span>
<span><span class="co">##   }</span></span></code></pre>
<p><strong>Please reference this paper if you use the PLP Package in
your work:</strong></p>
<p><a href="https://dx.doi.org/10.1093/jamia/ocy032" class="external-link">Reps JM, Schuemie
MJ, Suchard MA, Ryan PB, Rijnbeek PR. Design and implementation of a
standardized framework to generate and evaluate patient-level prediction
models using observational healthcare data. J Am Med Inform Assoc.
2018;25(8):969-975.</a></p>
<p>This work is supported in part through the National Science
Foundation grant IIS 1251151.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Egill Fridgeirsson, Jenna Reps, Martijn Schuemie, Marc Suchard, Patrick Ryan, Peter Rijnbeek.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
